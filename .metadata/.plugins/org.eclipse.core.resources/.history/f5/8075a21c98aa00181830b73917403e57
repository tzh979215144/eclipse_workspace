package com.bjsxt.sorm.core;

import java.lang.reflect.Method;
import java.util.List;

import com.bjsxt.sorm.bean.ColumnInfo;
import com.bjsxt.sorm.bean.TableInfo;
import com.bjsxt.sorm.util.StringUtils;

/**
 * 负责针对MySQL数据库的查询（对外提供服务的核心类）
 * @author tanpang
 *
 */
public class MySqlQuery implements Query {

	@Override
	public int executeDML(String sql, Object[] params) {
		// TODO Auto-generated method stub
		return 0;
	}

	@Override
	public void insert(Object obj) {
		// TODO Auto-generated method stub
		
	}

	@Override
	public void delete(Class clazz, Object id) {
			//Emp.class,2--->delete from emp where id=2
		
			//通过class对象找TableInfo
			TableInfo tableInfo = TableContext.poClassTableMap.get(clazz);
			//获得主键
			ColumnInfo onlyPrikey = tableInfo.getOnlyPriKey();
			
			String sql = "delete from "+tableInfo.getTname()+" where "+onlyPrikey.getName()+"=?";
			
			executeDML(sql,new Object[] {id});
	}

	@Override
	public void delete(Object obj) {

		Class c = obj.getClass();
		//通过class对象找TableInfo
		TableInfo tableInfo = TableContext.poClassTableMap.get(c);
		//获得主键
		ColumnInfo onlyPrikey = tableInfo.getOnlyPriKey();
		
		//通过反射机制，调用属性对应的get和set方法
		Method m = c.getMethod("get"+StringUtils.firstChar2UpperCase(onlyPrikey.getName()), null);
		
		Object priKeyValue = m.invoke(obj, null);
		String sql = "delete from "+tableInfo.getTname()+" where "+onlyPrikey.getName()+"=?";
		
		
		executeDML(sql,new Object[] {id});
		
	}

	@Override
	public int update(Object obj, String[] fieldNames) {
		// TODO Auto-generated method stub
		return 0;
	}

	@Override
	public List queryRows(String sql, Class clazz, Object[] params) {
		// TODO Auto-generated method stub
		return null;
	}

	@Override
	public Object queryUniqueRow(String sql, Class clazz, Object[] params) {
		// TODO Auto-generated method stub
		return null;
	}

	@Override
	public Object queryValue(String sql, Object[] params) {
		// TODO Auto-generated method stub
		return null;
	}

	@Override
	public Number queryNumber(String sql, Object[] params) {
		// TODO Auto-generated method stub
		return null;
	}

}
